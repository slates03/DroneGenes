---
title: "01-Radar_Plot.md"
author: "Garett Slater"
date: "April 21 2022"
output:
  html_document: default
  pdf_document: default
---

I used a radar plot to better visualized differences between the 4 lines among 5 traits. I used Z-score to standardize the differences

-   Sperm Traits
    -   Sperm Concentration (10\^6)
    -   Sperm Viability (%)
-   Flight Traits
    -   Mean Flight Duration (per day)
    -   First Flight Age (Day)
    -   Maturity (yes/no)
-   Morphology
    -   Weight (mg)
    -   frontwing length (mm)
    -   head length (mm)


```{r knitr setup, include=FALSE,  eval=TRUE, echo=FALSE, warning=FALSE}
library(knitr)
knitr::opts_chunk$set(eval=TRUE, cache=FALSE, message=FALSE, warning=FALSE, 
                      comment = "")
```


```{r data}

# Display the current working directory
getwd();

library(pacman)
p_load(readxl,dplyr,tidyverse,lme4,fmsb)

#Upload Trait Files
Sample<-read_excel("~/OneDrive/Manuscripts/GenesOfDrones/Resources/Expression_Drone_Trait.xlsx",sheet="Sample")
Sperm<-read_excel("~/OneDrive/Manuscripts/GenesOfDrones/Resources/Expression_Drone_Trait.xlsx",sheet="Sperm")
Weight<-read_excel("~/OneDrive/Manuscripts/GenesOfDrones/Resources/Expression_Drone_Trait.xlsx",sheet="Weight")
Morpho<-read_excel("~/OneDrive/Manuscripts/GenesOfDrones/Resources/Expression_Drone_Trait.xlsx",sheet="Morpho")
ID<-read_excel("~/OneDrive/Manuscripts/GenesOfDrones/Resources/Expression_Drone_Trait.xlsx",sheet="ID")
tx2gene<-read.csv("~/OneDrive/Manuscripts/GenesOfDrones/Resources/AMEL_tx2gene.csv")
RFID_out<-read.csv("~/OneDrive/Manuscripts/GenesOfDrones/Resources/RFID_2020Final_out.csv")

#Summarized Flight Trait data
RFID_out<-merge(RFID_out,ID,by="UID")
RFID_out$UTCTime_Final<- with(RFID_out, as.POSIXct(paste(UTCDate, UTCTime), format="%m/%d/%Y %H:%M:%OS"))
var_out<-RFID_out %>% group_by(UID) %>% dplyr::summarise(N_flights=length(flight),mean_flight_timediff=mean(timediff)/60,first_flight_age=min(Drone_Age))
```



# Morphometric Data Z scores

```{r echo=FALSE}
#Morphometric data filtering
Morpho_1<-merge(Morpho,ID)
Morpho_1<-merge(Weight,Morpho_1)

#Filter important Data
Morpho_1<-dplyr::select(Morpho_1,"ID","Line","hindwing_width","frontwing_length","Weight","Maturity")    

#Change Maturity data to usable form
Morpho_1$Maturity<-as.numeric(c("NM" = "0", "M" = "1")[Morpho_1$Maturity])

#Estimate Z-scores for the morphometric traits
Morpho_Z<- Morpho_1 %>% mutate(hindwing_width_Z = (hindwing_width - mean(hindwing_width))/sd(hindwing_width),
                               frontwing_length_Z = (frontwing_length - mean(frontwing_length))/sd(frontwing_length),
                               Weight_Z = (Weight - mean(Weight))/sd(Weight),
                               Maturity_Z = (Maturity- mean(Maturity))/sd(Maturity))
Morpho_sum<-Morpho_Z %>% group_by(Line) %>% dplyr::summarise(hindwing_width=mean(hindwing_width_Z),frontwing_length=mean(frontwing_length_Z),Weight=mean(Weight_Z),Maturity=mean(Maturity))
Morpho_sum
```
# Sperm Data Z scores

```{r echo=FALSE}
sperm_1<-merge(Sperm,ID)
sperm_1<-sperm_1[which(sperm_1$phen_age==14),]
sperm_1<-dplyr::select(sperm_1,"ID","Line","Sperm_Conc_2","Sperm_viability")

sperm_Z<- sperm_1 %>% mutate(Sperm_Conc_2_Z = (Sperm_Conc_2 - mean(Sperm_Conc_2))/sd(Sperm_Conc_2),
                             Sperm_viability_Z = (Sperm_viability - mean(Sperm_viability))/sd(Sperm_viability))
sperm_sum<-sperm_Z %>% group_by(Line) %>% dplyr::summarise(Sperm_Conc=mean(Sperm_Conc_2_Z),Sperm_viability=mean(Sperm_viability_Z))
sperm_sum
```

# Flight Data Z scores

```{r echo=FALSE}
flight_1<-merge(var_out,ID,by="UID")
flight_1<-flight_1[which(flight_1$phen_age==14),]
flight_1<-dplyr::select(flight_1,"ID","Line","first_flight_age","mean_flight_timediff")    

flight_Z<- flight_1 %>% mutate(first_flight_age_Z = (first_flight_age - mean(first_flight_age))/sd(first_flight_age),
                               mean_flight_timediff_Z = (mean_flight_timediff - mean(mean_flight_timediff))/sd(mean_flight_timediff))

flight_sum<-flight_Z %>% group_by(Line) %>% dplyr::summarise(first_flight_age=mean(first_flight_age_Z),
                                                             mean_flight_timediff=mean(mean_flight_timediff_Z))
flight_sum
```

# Radar Plot

```{r echo=FALSE}
#Combine Z score dataframes and summarize
radar_traits<-cbind(Morpho_sum,sperm_sum,flight_sum)
radar_traits <- dplyr::select(radar_traits,"hindwing_width","frontwing_length","Weight","Maturity","Sperm_Conc",
                              "Sperm_viability","first_flight_age","mean_flight_timediff")


#Set Max-Min of 0 and 1 for the Radar plot
min_max <- data.frame(matrix(c(1,-1,1,-1,1,-1,1,-1,1,-1,1,-1,1,-1,1,-1),nrow=2))
rownames(min_max)<-c("max","min")
colnames(min_max)<-colnames(radar_traits)


##Radar Plot All
radar_traits<-rbind(min_max,radar_traits)
radarchart(radar_traits)
```



